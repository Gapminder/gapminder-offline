<div style="height: 100%" (click)="appMainClickHandler($event)">
    <div style="position: absolute; top: -4px; left: 10px;">
        <a class="header-title">GAPMINDER TOOLS</a>
    </div>

    <div style="position: absolute; top: 0; right: 50px; width: 300px;">
        <ae-auto-update></ae-auto-update>
    </div>

    <div style="position: absolute; top: 0; right: 0;">
        <div class="ddf-menu">
            <div class="btn-group">

                <button type="button" (click)="switchMenu()" class="main-menu-btn"><img src="./public/images/hamburger.png"/></button>

                <ul role="menu" aria-labelledby="single-button" class="menu show-menu" *ngIf="isMenuOpen">
                    <li class="menu-item submenu">
                        <button type="button" class="menu-btn"><span class="menu-text">New chart</span></button>
                        <ul class="menu">
                            <li class="menu-item" (click)="doGapminderChart()">
                                <button type="button" class="menu-btn"><span class="menu-text">Gapminder data</span></button>
                            </li>
                            <li class="menu-item submenu">
                                <button type="button" class="menu-btn"><span class="menu-text">Your data (bubble chart only)</span></button>
                                <ul class="menu">
                                    <li class="menu-item" (click)="doNewCsvFile()">
                                        <button type="button" class="menu-btn"><span class="menu-text">CSV file...</span></button>
                                    </li>
                                    <li class="menu-item" (click)="doNewDdfFolder()">
                                        <button type="button" class="menu-btn"><span class="menu-text">DDF folder</span></button>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item submenu">
                        <button type="button" class="menu-btn"><span class="menu-text">Add your data</span></button>
                        <ul class="menu">
                            <li class="menu-item" *ngIf="getCurrentTab().selectedChartType" (click)="doAddCsvFile()">
                                <button type="button" class="menu-btn"><span class="menu-text">CSV file...</span></button>
                            </li>
                            <li class="menu-item" *ngIf="getCurrentTab().selectedChartType" (click)="doAddDdfFolder()">
                                <button type="button" class="menu-btn"><span class="menu-text">DDF folder</span></button>
                            </li>
                            <li class="menu-item" *ngIf="!getCurrentTab().selectedChartType">
                                <button type="button" class="menu-btn"><span class="menu-text" style="color: grey">CSV file...</span></button>
                            </li>
                            <li class="menu-item" *ngIf="!getCurrentTab().selectedChartType">
                                <button type="button" class="menu-btn"><span class="menu-text" style="color: grey">DDF folder</span></button>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-separator"></li>
                    <li class="menu-item" (click)="doOpen()">
                        <button type="button" class="menu-btn"><span class="menu-text">Open...</span></button>
                    </li>
                    <li class="menu-item" *ngIf="getCurrentTab().selectedChartType" (click)="doSave()">
                        <button type="button" class="menu-btn"><span class="menu-text">Save...</span></button>
                    </li>
                    <li class="menu-item" *ngIf="!getCurrentTab().selectedChartType">
                        <button type="button" class="menu-btn"><span class="menu-text"
                                                                     style="color: grey">Save...</span></button>
                    </li>
                    <li class="menu-item" *ngIf="getCurrentTab().selectedChartType === 'BubbleChart'"
                        (click)="doExportForWeb()">
                        <button type="button" class="menu-btn"><span class="menu-text">Export for Web...</span></button>
                    </li>
                    <li class="menu-item" *ngIf="getCurrentTab().selectedChartType !== 'BubbleChart'">
                        <button type="button" class="menu-btn"><span class="menu-text" style="color: grey">Export for Web...</span></button>
                    </li>
                    <li class="menu-separator"></li>
                    <li class="menu-item" (click)="checkForUpdates()">
                        <button type="button" class="menu-btn"><span class="menu-text">Check for updates...</span></button>
                    </li>
                    <li class="menu-item" (click)="openDevTools()">
                        <button type="button" class="menu-btn"><span class="menu-text">Open Developer Tools</span></button>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div style="min-width: 800px; height: calc(100% - 52px);">
        <tabset *ngIf="tabs.length > 0"
                style="height: 100%">
            <tab *ngFor="let tab of tabs"
                 [heading]="tab.title"
                 style="height: 100%"
                 [active]="tab.active"
                 (select)="tab.active = true; forceResize();"
                 (deselect)="tab.active = false"
                 [removable]="tab.removable">
                <div *ngIf="!tab.selectedChartType">
                    <div class="tab-chart-choice">Choose Chart Type</div>
                    <ul class="tab-chart-list">
                        <li (click)="selectChart('BubbleChart')">
                            <div><img src="./public/images/tools/bubblechart.png"><span>Bubble Chart</span></div>
                        </li>
                        <li (click)="selectChart('BubbleMap')">
                            <div><img src="./public/images/tools/bubblemap.png"><span>Bubble Map</span></div>
                        </li>
                        <li (click)="selectChart('MountainChart')">
                            <div><img src="./public/images/tools/mountainchart.png"><span>Mountain Chart</span></div>
                        </li>
                    </ul>
                </div>
                <div *ngIf="tab.selectedChartType" style="height: 100%;">
                    <vizabi *ngIf="tab.selectedChartType"
                            style="height: 100%;"
                            (onCreated)="chartCreated($event)"
                            (onChanged)="chartChanged($event)"
                            (onClick)="appMainClickHandler($event)"
                            [order]="tab.getOrder()"
                            [readerModuleObject]="tab.readerModuleObject"
                            [readerGetMethod]="tab.readerGetMethod"
                            [readerParams]="tab.readerParams"
                            [readerName]="tab.readerName"
                            [model]="tab.model"
                            [extResources]="tab.extResources"
                            [additionalItems]="tab.additionalData"
                            [chartType]="tab.chartType"></vizabi>
                </div>
            </tab>
        </tabset>
    </div>

    <div bsModal
         #versionsModal="bs-modal"
         class="modal fade"
         tabindex="-1"
         role="dialog"
         aria-labelledby="Versions"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" (click)="versionsModal.hide()" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">Update</h4>
                </div>
                <div class="modal-body">
                    <ae-versions-form (done)="versionsFormComplete($event)"></ae-versions-form>
                </div>
            </div>
        </div>
    </div>

    <div bsModal
         #csvConfigModal="bs-modal"
         class="modal fade"
         tabindex="-1"
         role="dialog"
         aria-labelledby="New bubble chart from your data"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" (click)="csvConfigModal.hide()" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">New bubble chart from your data</h4>
                </div>
                <div class="modal-body">
                    <ae-csv-config-form (done)="csvConfigFormComplete($event)"></ae-csv-config-form>
                </div>
            </div>
        </div>
    </div>

    <div bsModal
         *ngIf="getCurrentTab()"
         #additionalCsvConfigModal="bs-modal"
         class="modal fade"
         tabindex="-1"
         role="dialog"
         aria-labelledby="Add your data to bubble chart"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" (click)="additionalCsvConfigModal.hide()" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">Add your data to the chart</h4>
                </div>
                <div class="modal-body">
                    <ae-csv-config-form [addDataMode]="true" [parent]="getParent()"
                                        (done)="additionalCsvConfigFormComplete($event)"></ae-csv-config-form>
                </div>
            </div>
        </div>
    </div>


    <input id="newDdfFolder" type="file" style="display: none;" #newDdfFolder
           (click)="onDdfFolderClick($event, onDdfFolderChanged)"/>
    <input id="addDdfFolder" type="file" style="display: none;" #addDdfFolder
           (click)="onDdfFolderClick($event, onDdfExtFolderChanged)"/>
</div>