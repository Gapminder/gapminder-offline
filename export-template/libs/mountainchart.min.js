!function(a){var i={};function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=a,n.c=i,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,a){e.exports=a(1)},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a(2);var i,n=a(3),r=(i=n)&&i.__esModule?i:{default:i};a(8);var o=Vizabi.Tool.extend("MountainChart",{init:function(e,t){this.name="mountainchart",this.components=[{component:r.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","data","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.time","locale","ui"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(e,t)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:.7}},locale:{},ui:{chart:{decorations:{enabled:!0,xAxisGroups:null},manualSortingEnabled:!0,yMaxMethod:"latest",showProbeX:!0,probeX:1.85,xLogStops:[1,2,5],xPoints:50,directSigma:!1,directMu:!1,preload:"income_mountains",preloadKey:"world"},buttons:["colors","find","stack","moreoptions","presentation","sidebarcollapse","fullscreen"],dialogs:{popup:["colors","find","stack","moreoptions"],sidebar:["colors","find","stack"],moreoptions:["opacity","speed","stack","axesmc","colors","presentation","technical","about"]},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}},versionInfo:{version:"2.4.2",build:1548844897069}});t.default=o},function(e,t,a){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(4)),r=a(i(5)),o=a(i(6));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var s=Vizabi,h=s.utils,c=(s._globals,s.iconset),d=c.warn,m=c.question,u=s.helpers,g=u.svgexport,p=u["d3.axisWithLabelPicker"],x=u["d3.dynamicBackground"],v="#d3d3d3",f=Vizabi.Component.extend("mountainchart",{init:function(e,t){var a=this;this.name="mountainchart",this.template=i(7),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"data",type:"data"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(e){a._readyOnce&&a.model.marker.getFrame(a.model.time.value,a.frameChanged.bind(a))},"change:time.playing":function(e){a.model.time.playing||a.redrawDataPoints()},"change:marker.axis_x.xScaleFactor":function(){a.ready()},"change:marker.axis_x.xScaleShift":function(){a.ready()},"change:marker.axis_x.tailFatX":function(){a.ready()},"change:marker.axis_x.tailCutX":function(){a.ready()},"change:marker.axis_x.tailFade":function(){a.ready()},"change:ui.chart.probeX":function(){a.ready()},"change:ui.chart.showProbeX":function(){a.ready()},"change:ui.chart.xPoints":function(){a.ready()},"change:ui.chart.xLogStops":function(){a.updateSize()},"change:ui.chart.yMaxMethod":function(){a._adjustMaxY({force:!0}),a.redrawDataPoints()},"change:ui.chart.decorations":function(e){a._readyOnce&&a._updateDecorations(500)},"change:ui.chart.showForecastOverlay":function(e){a._readyOnce&&a._updateForecastOverlay()},"change:time.record":function(e){a.model.time.record?a._export.open(this.element,this.name):a._export.reset()},"change:marker.highlight":function(e){a._readyOnce&&(a.highlightMarkers(),a.updateOpacity())},"change:marker.select":function(e){a._readyOnce&&(a.selectMarkers(),a._selectlist.redraw(),a.updateOpacity(),a.updateDoubtOpacity(),a.redrawDataPoints(),a._probe.redraw())},"change:marker.opacitySelectDim":function(e){a.updateOpacity()},"change:marker.opacityRegular":function(e){a.updateOpacity()},"change:marker":function(e,t){a._readyOnce&&(-1<t.indexOf("scaleType")?a.ready():(-1<t.indexOf("zoomedMin")||-1<t.indexOf("zoomedMax"))&&(a.zoomToMaxMin(),a.redrawDataPoints(),a._probe.redraw()))},"change:marker.group":function(e,t){a._readyOnce&&(-1<t.indexOf("group.merge")||a.ready())},"change:marker.group.merge":function(e){a._readyOnce&&(a.updatePointers(),a.redrawDataPoints())},"change:marker.stack":function(e){a._readyOnce&&a.ready()},"change:marker.stack.which":function(e){a._readyOnce&&a.model.time.playing&&a.model.time.pause()},"change:marker.stack.use":function(e){a._readyOnce&&a.model.time.playing&&a.model.time.pause()},"change:marker.color.palette":function(e){a._readyOnce&&(a.redrawDataPointsOnlyColors(),a._selectlist.redraw())}},this._super(e,t),this._math=new n.default(this),this._export=new g(this),this._export.prefix("vzb-mc-").deleteClasses(["vzb-mc-mountains-mergestacked","vzb-mc-mountains-mergegrouped","vzb-mc-mountains","vzb-mc-year","vzb-mc-mountains-labels","vzb-mc-axis-labels"]),this._probe=new o.default(this),this._selectlist=new r.default(this),this.area=d3.area().curve(d3.curveBasis).x(function(e){return a.xScale(a._math.rescale(e.x))}).y0(function(e){return a.yScale(e.y0)}).y1(function(e){return a.yScale(e.y0+e.y)}),this.stack=d3.stack().order(d3.stackOrderReverse).value(function(e,t){return a.cached[t][e].y}),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=p("bottom"),this.rangeRatio=1,this.rangeShift=0,this.cached={},this.mesh=[],this.yMax=0},domReady:function(){var a=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-mc-graph"),this.xAxisEl=this.graph.select(".vzb-mc-axis-x"),this.xTitleEl=this.graph.select(".vzb-mc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-mc-axis-y-title"),this.infoEl=this.graph.select(".vzb-mc-axis-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yearEl=this.graph.select(".vzb-mc-year"),this.year=new x(this.yearEl),this.mountainMergeStackedContainer=this.graph.select(".vzb-mc-mountains-mergestacked"),this.mountainMergeGroupedContainer=this.graph.select(".vzb-mc-mountains-mergegrouped"),this.mountainAtomicContainer=this.graph.select(".vzb-mc-mountains"),this.mountainLabelContainer=this.graph.select(".vzb-mc-mountains-labels"),this.tooltip=this.element.select(".vzb-mc-tooltip"),this.eventAreaEl=this.element.select(".vzb-mc-eventarea"),this.probeEl=this.element.select(".vzb-mc-probe"),this.probeLineEl=this.probeEl.select("line"),this.probeTextEl=this.probeEl.selectAll("text"),this.forecastOverlay=this.element.select(".vzb-mc-forecastoverlay"),this.decorationsEl=this.graph.select(".vzb-mc-decorations"),this.xAxisGroupsEl=this.decorationsEl.select(".vzb-mc-x-axis-groups"),this.element.onTap(function(e,t){a._interact()._mouseout(e,t)})},afterPreload:function(){var a=this;if(this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.precomputedShape&&this.precomputedShape[0]&&this.precomputedShape[0].income_mountains){var e=this.precomputedShape[0].income_mountains["yMax_"+this.model.ui.chart.yMaxMethod],t=this.precomputedShape[0].income_mountains.shape;e&&t&&0!==t.length&&(this.xScale=d3.scaleLog().domain([this.model.marker.axis_x.domainMin,this.model.marker.axis_x.domainMax]),this.yScale=d3.scaleLinear().domain([0,Math.round(e)]),a.updateSize(t.length),a.zoomToMaxMin(),t=t.map(function(e,t){return{x:a.mesh[t],y0:0,y:+e}}),this.mountainAtomicContainer.selectAll(".vzb-mc-prerender").data([0]).enter().append("path").attr("class","vzb-mc-prerender").style("fill","pink").style("opacity",0).attr("d",a.area(t)).transition().duration(1e3).ease(d3.easeLinear).style("opacity",1))}},readyOnce:function(){this.eventAreaEl.on("mousemove",function(){e.model.time.dragging||e.model.ui.chart.showProbeX&&e._probe.redraw({level:e.xScale.invert(d3.mouse(this)[0]),full:!0})}).on("mouseout",function(){e.model.time.dragging||e.model.ui.chart.showProbeX&&e._probe.redraw()});var e=this;this.on("resize",function(){e.updateSize()||(e.updatePointers(),e.redrawDataPoints(),e._selectlist.redraw(),e._probe.redraw())}),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=h.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this.mountainAtomicContainer.select(".vzb-mc-prerender").remove(),this.year.setText(this.model.time.formatDate(this.model.time.value)),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange)},ready:function(){var t=this;this.KEYS=h.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.updateUIStrings(),this.updateIndicators(),this.model.marker.getFrame(this.model.time.value,function(e){e&&(t.values=e,t.valuesAggregated={color:{},axis_y:{}},t.model.marker.getFrame(t.model.time.end,function(e){t.updateEntities(e),t.updateSize(),t.zoomToMaxMin(),t._spawnMasks(),t.updateTime(),t.updatePointers(),t._adjustMaxY({force:!0}),t.redrawDataPoints(),t.redrawDataPointsOnlyColors(),t.highlightMarkers(),t.selectMarkers(),t._selectlist.redraw(),t.updateOpacity(),t.updateDoubtOpacity(),t._probe.redraw()}))})},frameChanged:function(e,t){if(!e)return h.warn("change:time.value: empty data received from marker.getFrame(). doing nothing");t.toString()==this.model.time.value.toString()&&(this.values=e,this.updateTime(),this.updatePointers(),this.redrawDataPoints(),this._selectlist.redraw(),this._probe.redraw(),this.updateDoubtOpacity())},updateSize:function(e){this.activeProfile=this.getActiveProfile({small:{margin:{top:10,right:10,left:10,bottom:18},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},{medium:{margin:{top:20,right:20,left:20,bottom:50},infoElHeight:26},large:{margin:{top:30,right:30,left:30,bottom:50},infoElHeight:32}});var t=this.activeProfile.margin,a=this.activeProfile.infoElHeight;this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,h.warn("Mountain chart updateSize(): vizabi container is too little or has display:none")),this.graph.attr("transform","translate("+t.left+","+t.top+")");var i=this.model.locale.isRTL(),n={topOffset:"large"===this.getLayoutProfile()?2*t.top:0,xAlign:"large"===this.getLayoutProfile()?i?"left":"right":"center",yAlign:"large"===this.getLayoutProfile()?"top":"center",widthRatio:"large"===this.getLayoutProfile()?3/8:.8};this.year.setConditions(n).resize(this.width,this.height),this.yScale.range([this.height,0]),this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]);var r=this._readyOnce?this.model.marker.axis_x.scaleType:"log";this.xAxis.scale(this.xScale).tickSizeOuter(0).tickPadding(9).tickSizeMinor(3,0).labelerOptions({scaleType:r,toolMargin:t,pivotingLimit:1.5*t.bottom,method:this.xAxis.METHOD_REPEATING,stops:this._readyOnce?this.model.ui.chart.xLogStops:[1],formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xTitleEl.select("text").attr("transform","translate("+this.width+","+this.height+")").attr("dy","-0.36em"),this.yTitleEl.style("font-size",a+"px").attr("transform","translate("+(i?this.width:0)+","+t.top+")"),this.xAxisGroupsEl.style("font-size",.8*a+"px");var o=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",o.height).attr("height",o.height).attr("x",.1*o.height).attr("y",1*-o.height+1),this.dataWarningEl.attr("transform","translate("+(i?this.width-o.width-2*o.height:0)+","+(t.top+1.5*o.height)+")").select("text").attr("dx",1.5*o.height),this.infoEl.select("svg").node()){var s=this.yTitleEl.node().getBBox(),l=h.transform(this.yTitleEl.node()),c=i?s.x+l.translateX-1.4*a:s.x+l.translateX+s.width+.4*a;this.infoEl.select("svg").attr("width",a+"px").attr("height",a+"px"),this.infoEl.attr("transform","translate("+c+","+(l.translateY-.8*a)+")")}this.eventAreaEl.attr("y",this.height).attr("width",this.width).attr("height",t.bottom),e||(e=this.model.ui.chart.xPoints),this.mesh=this._math.generateMesh(e,r,this.xScale.domain())},_updateDecorations:function(l){var n=this,e=this.model.ui.chart.decorations.xAxisGroups&&this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which]&&this.model.ui.chart.decorations.enabled&&"small"!==this.getLayoutProfile();if(this.xAxisGroupsEl.classed("vzb-invisible",!e),e){var t=this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which],a=this.xAxisGroupsEl.selectAll(".vzb-mc-x-axis-group").data(t);a.exit().remove(),a=a.enter().append("g").attr("class","vzb-mc-x-axis-group").each(function(){var e=d3.select(this);e.append("text").attr("class","vzb-mc-x-axis-group-line").text("◆").style("text-anchor","middle"),e.append("text").attr("class","vzb-mc-x-axis-group-text")}).merge(a);var c=[],r=!1;a.each(function(e,t){var a=d3.select(this).select("text.vzb-mc-x-axis-group-text").text(n.translator(e.label)),i={min:e.min,max:e.max};i.textHeight=a.node().getBBox().height,i.textWidth=a.node().getBBox().width,i.boundaryMinX_px=n.xScale(e.min||0===e.min?e.min:d3.min(n.xScale.domain())),i.boundaryMaxX_px=n.xScale(e.max||0===e.max?e.max:d3.max(n.xScale.domain())),i.centerX_px=(i.boundaryMinX_px+i.boundaryMaxX_px)/2,i.marginX_px=(Math.abs(i.boundaryMinX_px-i.boundaryMaxX_px)-i.textWidth)/2,i.marginX_px-i.textHeight<0&&(r=!0),c[t]=i}),r&&a.each(function(e,t){var a=d3.select(this).select("text.vzb-mc-x-axis-group-text").text(n.translator(e.label_short)),i=c[t];i.textWidth=a.node().getBBox().width,i.marginX_px=(Math.abs(i.boundaryMinX_px-i.boundaryMaxX_px)-i.textWidth)/2,c[t]=i}),a.each(function(e,t){var a=d3.select(this),i=0==t,n=t==c.length-1,r=c[t],o=r.textHeight/4,s=r.centerX_px;i&&(s=c[t+1].boundaryMinX_px-Math.max(c[t+1].marginX_px,o)),n&&(s=c[t-1].boundaryMaxX_px+Math.max(c[t-1].marginX_px,o));a.select("text.vzb-mc-x-axis-group-text").transition().duration(l||0).style("text-anchor",i?"end":n?"start":"middle").attr("dy","-1.2em").attr("y",r.textHeight).attr("x",s);a.select("text.vzb-mc-x-axis-group-line").classed("vzb-invisible",n).transition().duration(l||0).attr("dy","-1.2em").attr("y",.9*r.textHeight).attr("x",r.boundaryMaxX_px)}),a.select("text.vzb-mc-x-axis-group-text").on("mouseenter",function(e,t){var a=c[t],i=d3.select(this.parentNode);d3.select(this).attr("font-weight","bold"),i.append("rect").lower().attr("x",a.boundaryMinX_px).attr("width",a.boundaryMaxX_px-a.boundaryMinX_px).attr("y",-n.activeProfile.margin.top).attr("height",n.height+n.activeProfile.margin.top),(a.min||0===a.min)&&i.append("line").lower().attr("x1",a.boundaryMinX_px).attr("x2",a.boundaryMinX_px).attr("y1",-n.activeProfile.margin.top).attr("y2",n.height),(a.max||0===a.max)&&i.append("line").lower().attr("x1",a.boundaryMaxX_px).attr("x2",a.boundaryMaxX_px).attr("y1",-n.activeProfile.margin.top).attr("y2",n.height)}).on("mouseleave",function(e,t){var a=d3.select(this.parentNode);d3.select(this).attr("font-weight",null),a.selectAll("rect").remove(),a.selectAll("line").remove()})}},zoomToMaxMin:function(){var e=this.model.marker.axis_x;if(!(null==e.zoomedMin&&null==e.domainMin||null==e.zoomedMax&&null==e.domainMin)){var t=this.xScale(e.zoomedMin||e.domainMin),a=this.xScale(e.zoomedMax||e.domainMax);isFinite(t)&&isFinite(a)&&t!==a&&(this.rangeRatio=this.width/(a-t)*this.rangeRatio,this.rangeShift=(this.rangeShift-t)/(a-t)*this.width,this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]),this.xAxisEl.call(this.xAxis))}},updateUIStrings:function(){var n=this;this.translator=this.model.locale.getTFunction();this.model.marker.axis_x.getConceptprops();this.xTitleEl.select("text").text(this.translator("unit/mountainchart_hardcoded_income_per_day")),this.yTitleEl.select("text").text(this.translator("mount/title")),h.setIcon(this.dataWarningEl,d).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),h.setIcon(this.infoEl,m).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){n.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=this.getBBox(),t=h.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),a=n.root.element.getBoundingClientRect(),i=n.element.node().getBoundingClientRect();n.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(t.x+i.left-a.left,t.y)}),this.infoEl.on("mouseout",function(){n.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){n.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){n.updateDoubtOpacity(1)}).on("mouseout",function(){n.updateDoubtOpacity()})},updateDoubtOpacity:function(e){null==e&&(e=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(e=1),this.dataWarningEl.style("opacity",e)},updateIndicators:function(){this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter())},updateEntities:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.values,i=this,n=this.dataKeys;this.mountainPointers=this.model.marker.getKeys().filter(function(e){return a.axis_x[h.getKey(e,n.axis_x)]&&a.axis_y[h.getKey(e,n.axis_y)]&&a.axis_s[h.getKey(e,n.axis_s)]}).map(function(e){var t={};return t._keys=e,t.KEYS=function(){return this._keys},t._key=h.getKey(e,i.KEYS),t.KEY=function(){return this._key},t.sortValue=[a.axis_y[h.getKey(e,n.axis_y)]||0,0],t.aggrLevel=0,t}),this.groupedPointers=d3.nest().key(function(e){return"property"===i.model.marker.stack.use?a.stack[h.getKey(e.KEYS(),n.stack)]:a.group[h.getKey(e.KEYS(),n.group)]}).sortValues(function(e,t){return t.sortValue[0]-e.sortValue[0]}).entries(this.mountainPointers);var r=this.model.marker.group.manualSorting,o=h.isArray(r)&&1<r.length;this.groupedPointers.forEach(function(e){var t=o?r.includes(e.key)?r.length-1-r.indexOf(e.key):-1:d3.sum(e.values.map(function(e){return e.sortValue[0]}));e.values.forEach(function(e){e.sortValue[1]=t}),e._keys=l({},i.KEY,e.key),e.KEYS=function(){return this._keys},e.KEY=function(){return this.key},e.aggrLevel=1});var s={};i.groupedPointers.forEach(function(e){s[e.key]=e.values[0].sortValue[1]}),"none"===i.model.marker.stack.which?(this.stackedPointers=[],this.mountainPointers.sort(function(e,t){return t.sortValue[0]-e.sortValue[0]})):(this.stackedPointers=d3.nest().key(function(e){return a.stack[h.getKey(e.KEYS(),n.stack)]}).key(function(e){return a.group[h.getKey(e.KEYS(),n.group)]}).sortKeys(function(e,t){return s[t]-s[e]}).sortValues(function(e,t){return t.sortValue[0]-e.sortValue[0]}).entries(this.mountainPointers),this.mountainPointers.sort(function(e,t){return t.sortValue[1]-e.sortValue[1]}),this.stackedPointers.forEach(function(e){e._keys=l({},i.KEY,e.key),e.KEYS=function(){return this._keys},e.KEY=function(){return this.key},e.aggrLevel=2})),this.mountainsMergeStacked=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel2").data(this.stackedPointers),this.mountainsMergeGrouped=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel1").data(this.groupedPointers),this.mountainsAtomic=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel0").data(this.mountainPointers),this.mountainsMergeStacked.exit().remove(),this.mountainsMergeGrouped.exit().remove(),this.mountainsAtomic.exit().remove(),this.mountainsMergeStacked=this.mountainsMergeStacked.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel2").merge(this.mountainsMergeStacked),this.mountainsMergeGrouped=this.mountainsMergeGrouped.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel1").merge(this.mountainsMergeGrouped),this.mountainsAtomic=this.mountainsAtomic.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel0").merge(this.mountainsAtomic),this.mountains=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain"),this.mountains.on("mousemove",function(e,t){h.isTouchDevice()||i._interact()._mousemove(e,t)}).on("mouseout",function(e,t){h.isTouchDevice()||i._interact()._mouseout(e,t)}).on("click",function(e,t){h.isTouchDevice()||(i._interact()._click(e,t),i.highlightMarkers())}).onTap(function(e,t){i._interact()._click(e,t),d3.event.stopPropagation()}).onLongTap(function(e,t){})},_getLabelText:function(t,a,i){return this.KEYS.map(function(e){return t[a[e]]?t[a[e]][i[e]]:i[e]}).join(", ")},_interact:function(){var a=this;return{_mousemove:function(e,t){if(!a.model.time.dragging&&!a.model.time.playing){a.model.marker.highlightMarker(e.KEYS());d3.mouse(a.graph.node()).map(function(e){return parseInt(e)});a._setTooltip(e.key?a.model.marker.color.getColorlegendMarker().label.getItems()[e.key]:a._getLabelText(a.values,a.labelNames,e.KEYS())),a._selectlist.showCloseCross(e,!0)}},_mouseout:function(e,t){a.model.time.dragging||a.model.time.playing||(a._setTooltip(""),a.model.marker.clearHighlighted(),a._selectlist.showCloseCross(e,!1))},_click:function(e){(a.model.time.dragging||a.model.time.playing)&&!a.model.marker.isSelected(e.KEYS())||a.model.marker.selectMarker(e.KEYS())}}},highlightMarkers:function(){var t=this;this.someHighlighted=0<this.model.marker.highlight.length,this.selectList&&this.someSelected&&this.selectList.classed("vzb-highlight",function(e){return t.model.marker.isHighlighted(e)})},selectMarkers:function(){this.someSelected=0<this.model.marker.select.length,this._selectlist.rebuild(),this.nonSelectedOpacityZero=!1},_sumLeafPointersByMarker:function(e,t){var a=this;return e.hasOwnProperty("key")?d3.sum(e.values.map(function(e){return a._sumLeafPointersByMarker(e,t)})):a.values[t][h.getKey(e.KEYS(),a.dataKeys[t])]},updateOpacity:function(){var t=this,a=this.model.marker.opacityRegular,i=this.model.marker.opacitySelectDim;this.mountains.style("opacity",function(e){return t.someHighlighted&&t.model.marker.isHighlighted(e.KEYS())?1:t.someSelected?t.model.marker.isSelected(e.KEYS())?1:i:t.someHighlighted?.3:a}),this.mountains.classed("vzb-selected",function(e){return t.model.marker.isSelected(e.KEYS())});var n=t.model.marker.opacitySelectDim<.01;n!==this.nonSelectedOpacityZero&&this.mountainsAtomic.style("pointer-events",function(e){return t.someSelected&&n&&!t.model.marker.isSelected(e.KEYS())?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&0<this.time-this.time_1?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this._updateForecastOverlay()},updatePointers:function(){var n=this;this.yMax=0,this.mountainPointers.forEach(function(e,t){var a=n._spawn(n.values,n.dataKeys,e);n.cached[e.KEY()]=a,e.hidden=0===a.length}),"none"!==n.model.marker.stack.which&&this.stackedPointers.forEach(function(e){var i=[];e.values.forEach(function(e){i=i.concat(e.values.filter(function(e){return!e.hidden}))}),n.stack.keys(i.map(function(e){return e.KEY()}))(d3.range(n.mesh.length)).forEach(function(e,t){var a=i[t].KEY();e.forEach(function(e,t){n.cached[a][t].y0=e[0]})})}),this.mountainPointers.forEach(function(e){e.valuesPointer=n.values,e.yMax=d3.max(n.cached[e.KEY()].map(function(e){return e.y0+e.y})),n.yMax<e.yMax&&(n.yMax=e.yMax)});var e=n.model.marker.group.merge,t=n.model.marker.stack.merge;this.stackedPointers.forEach(function(e){e.valuesPointer=n.valuesAggregated;var t=n._getFirstLastPointersInStack(e);n.cached[e.key]=n._getVerticesOfaMergedShape(t),n.valuesAggregated.color[e.key]="_default",n.valuesAggregated.axis_y[e.key]=n._sumLeafPointersByMarker(e,"axis_y"),e.yMax=t.first.yMax}),this.groupedPointers.forEach(function(e){e.valuesPointer=n.valuesAggregated;var t=n._getFirstLastPointersInStack(e);n.cached[e.key]=n._getVerticesOfaMergedShape(t),n.valuesAggregated.color[e.key]=n.values.color[t.first.KEY()],n.valuesAggregated.axis_y[e.key]=n._sumLeafPointersByMarker(e,"axis_y"),e.yMax=t.first.yMax}),t||e||"property"!==this.model.marker.stack.use||this.groupedPointers.forEach(function(t){var e=t.values.filter(function(e){return!e.hidden});t.yMax=e[0].yMax,t.values.forEach(function(e){e.yMaxGroup=t.yMax})})},_updateForecastOverlay:function(){this.forecastOverlay.classed("vzb-hidden",this.model.time.value<=this.model.time.endBeforeForecast||!this.model.time.endBeforeForecast||!this.model.ui.chart.showForecastOverlay)},_getFirstLastPointersInStack:function(e){var t=void 0,a=void 0,i=void 0,n=void 0;return n=e.values[0].values?(t=e.values[0].values.filter(function(e){return!e.hidden}),a=e.values[e.values.length-1].values.filter(function(e){return!e.hidden}),i=t[0],a[a.length-1]):(i=(t=e.values.filter(function(e){return!e.hidden}))[0],t[t.length-1]),(!t.length||a&&!a.length)&&h.warn("mountain chart failed to generate shapes. check the incoming data"),{first:i,last:n}},_getVerticesOfaMergedShape:function(e){var i=this,n=e.first.KEY(),r=e.last.KEY();return i.mesh.map(function(e,t){var a=i.cached[n][t].y0+i.cached[n][t].y-i.cached[r][t].y0;return{x:e,y0:i.cached[r][t].y0,y:a}})},_spawnMasks:function(){var a=this,i=this._math.unscale(this.model.marker.axis_x.tailFatX),n=this._math.unscale(this.model.marker.axis_x.tailCutX),r=this.model.marker.axis_x.tailFade,o=2*Math.PI/(Math.log(i)-Math.log(n)),s=Math.PI-Math.log(i)*o;this.spawnMask=[],this.cosineShape=[],this.cosineArea=0,this.mesh.forEach(function(e,t){a.spawnMask[t]=e<n?1:7*r<e?0:Math.exp((n-e)/r),a.cosineShape[t]=n<e&&e<i?1+Math.cos(Math.log(e)*o+s):0,a.cosineArea+=a.cosineShape[t]})},_spawn:function(e,t,a){var i=this,n=e.axis_y[h.getKey(a.KEYS(),t.axis_y)],r=i.model.ui.chart.directSigma?e.axis_s[h.getKey(a.KEYS(),t.axis_s)]:i._math.giniToSigma(e.axis_s[h.getKey(a.KEYS(),t.axis_s)]),o=i.model.ui.chart.directMu?e.axis_x[h.getKey(a.KEYS(),t.axis_x)]:i._math.gdpToMu(e.axis_x[h.getKey(a.KEYS(),t.axis_x)],r);if(!n||!o||!r)return[];var s=[],l=0;return this.mesh.forEach(function(e,t){s[t]=i._math.pdf.lognormal(e,o,r),l+=i.spawnMask[t]*s[t]}),this.mesh.map(function(e,t){return{x:e,y0:0,y:n*(s[t]*(1-i.spawnMask[t])+i.cosineShape[t]/i.cosineArea*l)}})},_adjustMaxY:function(e){e||(e={});var t=this,a=this.model.ui.chart.yMaxMethod;if("immediate"===a||e.force)if("latest"===a){var i=t.values;t.model.marker.getFrame(t.model.time.end,function(e){e&&(t.values=e,t.updatePointers(),t.values=i,t.yScale.domain([0,Math.round(t.yMax)]),t.updatePointers(),t.redrawDataPoints())})}else t.yMax||h.warn("Setting yMax to "+t.yMax+". You failed again :-/"),t.yScale.domain([0,Math.round(t.yMax)])},redrawDataPoints:function(){var n=this,r=this.model.marker.group.merge,o=this.model.marker.stack.merge,e=this.model.marker.stack.which,s=(this.model.time.dragging||this.model.time.playing)&&"none"!==e;this._adjustMaxY(),this.mountainsMergeStacked.each(function(e){var t=d3.select(this),a=!o;n._renderShape(t,e.KEY(),a)}),this.mountainsMergeGrouped.each(function(e){var t=d3.select(this),a=!r&&!s||o&&!n.model.marker.isSelected(e);n._renderShape(t,e.KEY(),a)}),this.mountainsAtomic.each(function(e,t){var a=d3.select(this),i=e.hidden||(r||o||s)&&!n.model.marker.isSelected(e);n._renderShape(a,e.KEY(),i)}),"none"===e?this.mountainsAtomic.sort(function(e,t){return t.yMax-e.yMax}):"all"===e||r||s||this.mountainsAtomic.sort(function(e,t){return t.yMaxGroup-e.yMaxGroup}),this._updateDecorations()},redrawDataPointsOnlyColors:function(){var a=this;if(!this.mountains)return h.warn("redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!");var i="indicator"===this.model.marker.color.use;this.mountains.style("fill",function(e){var t=e.valuesPointer.color[h.getKey(e.KEYS(),a.dataKeys.color)];return t?i&&"_default"==t?a.model.marker.color.palette._default:a.cScale(t):v})},_renderShape:function(e,t,a){var i=this.model.marker.stack.which,n=e.datum().valuesPointer;if(e.classed("vzb-hidden",a),a)"none"!==i&&e.style("stroke-opacity",0);else{var r={};r[this.KEY]=t,this.model.marker.isSelected(r)?e.attr("d",this.area(this.cached[t].filter(function(e){return e.y>.001*n.axis_y[t]}))):e.attr("d",this.area(this.cached[t])),"indicator"===this.model.marker.color.use&&e.style("fill",n.color[t]?"_default"!==n.color[t]?this.cScale(n.color[t]):this.model.marker.color.palette._default:v),"none"!==i&&e.transition().duration(900*Math.random()+100).ease(d3.easeCircle).style("stroke-opacity",.5),this.model.time.record&&this._export.write({type:"path",id:t,time:this.model.time.value.getUTCFullYear(),fill:this.cScale(n.color[t]),d:this.area(this.cached[t])})}},_setTooltip:function(e){if(e){var t=d3.mouse(this.graph.node()).map(function(e){return parseInt(e)});this.tooltip.classed("vzb-hidden",!1).attr("transform","translate("+t[0]+","+t[1]+")").selectAll("text").attr("text-anchor","middle").attr("alignment-baseline","middle").text(e);var a=this.tooltip.select("text").node().getBBox();this.tooltip.select("rect").attr("width",a.width+8).attr("height",a.height+8).attr("x",-a.width-25).attr("y",-a.height-25).attr("rx",.2*a.height).attr("ry",.2*a.height),this.tooltip.selectAll("text").attr("x",-a.width-25+(a.width+8)/2).attr("y",-a.height-25+(a.height+11)/2);var i=0<t[0]-a.width-25?t[0]:a.width+25,n=0<t[1]-a.height-25?t[1]:a.height+25;this.tooltip.attr("transform","translate("+i+","+n+")")}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){var e,a=this,i=this,n=h.getProp(this,["model","ui","chart","preload"]),t=h.getProp(this,["model","ui","chart","preloadKey"]);if(!n)return Promise.resolve();var r=this.model.marker._getFirstDimension({exceptType:"time"}),o=this.model.time.dim,s={language:this.model.locale.id,from:"datapoints",select:{key:[r,o],value:[n]},where:{$and:[l({},r,"$"+r),l({},o,"$"+o)]},join:(e={},l(e,"$"+r,{key:r,where:l({},r,{$in:[t||"world"]})}),l(e,"$"+o,{key:o,where:l({},o,this.model.time.formatDate(this.model.time.value))}),e),order_by:[o]};return new Promise(function(t,e){a.model.data.load(s,l({},n,function(e){return JSON.parse(e)})).then(function(e){i.precomputedShape=i.model.data.getData(e),t()},function(e){return h.warn("Problem with Preload mountainchart query: ",e,JSON.stringify(s))})})}});t.default=f},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});Vizabi.utils;var i=Vizabi.Class.extend({init:function(e){this.context=e,this.xScaleFactor=1,this.xScaleShift=0},rescale:function(e){return Math.exp(this.xScaleFactor*Math.log(e)+this.xScaleShift)},unscale:function(e){return Math.exp((Math.log(e)-this.xScaleShift)/this.xScaleFactor)},generateMesh:function(e,t,a){var i="linear"===t?a[0]:Math.log(this.unscale(a[0])),n="linear"===t?a[1]:Math.log(this.unscale(a[1])),r=(n-i)/e,o=d3.range(i,n,r).concat(n);return o="linear"!==t?o.map(function(e){return Math.exp(e)}):o.filter(function(e){return 0<e})},gdpToMu:function(e,t,a,i){return Math.log(e/365)-t*t/2},giniToSigma:function(e){return this.normsinv((e/100+1)/2)*Math.pow(2,.5)},pdf:{normal:function(e,t,a){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(a)-Math.pow(e-t,2)/(2*a*a))},lognormal:function(e,t,a){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(a)-Math.pow(Math.log(e)-t,2)/(2*a*a))}},normsinv:function(e){var t=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],a=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],i=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],n=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416];if(e<.02425){var r=Math.sqrt(-2*Math.log(e));return(((((i[0]*r+i[1])*r+i[2])*r+i[3])*r+i[4])*r+i[5])/((((n[0]*r+n[1])*r+n[2])*r+n[3])*r+1)}if(.97575<e){var o=Math.sqrt(-2*Math.log(1-e));return-(((((i[0]*o+i[1])*o+i[2])*o+i[3])*o+i[4])*o+i[5])/((((n[0]*o+n[1])*o+n[2])*o+n[3])*o+1)}var s=e-.5,l=s*s;return(((((t[0]*l+t[1])*l+t[2])*l+t[3])*l+t[4])*l+t[5])*s/(((((a[0]*l+a[1])*l+a[2])*l+a[3])*l+a[4])*l+1)}});t.default=i},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Vizabi,v=i.utils,r=i.iconset.close,n=Vizabi.Class.extend({init:function(e){this.context=e},rebuild:function(e){var n=this.context,a=this,t=n.mountainPointers.concat(n.groupedPointers).concat(n.stackedPointers).filter(function(e){return n.model.marker.isSelected(e.KEYS())}).sort(function(e,t){return e.sortValue&&t.sortValue?e.sortValue[1]===t.sortValue[1]?d3.descending(e.sortValue[0],t.sortValue[0]):d3.descending(e.sortValue[1],t.sortValue[1]):e.aggrLevel!=t.aggrLevel?d3.descending(e.aggrLevel,t.aggrLevel):e.aggrLevel&&t.aggrLevel?d3.descending(e.yMax,t.yMax):0});n.selectList=n.mountainLabelContainer.selectAll("g.vzb-mc-label").data(v.unique(t,function(e){return e.KEY()})),n.selectList.exit().remove(),n.selectList=n.selectList.enter().append("g").attr("class","vzb-mc-label").each(function(e,t){var a=d3.select(this);a.append("circle").attr("class","vzb-mc-label-legend"),a.append("text").attr("class","vzb-mc-label-shadow vzb-mc-label-text"),a.append("text").attr("class","vzb-mc-label-text"),a.append("g").attr("class","vzb-mc-label-x vzb-label-shadow vzb-invisible").on("click",function(e,t){v.isTouchDevice()||(d3.event.stopPropagation(),n.model.marker.clearHighlighted(),n.model.marker.selectMarker(e.KEYS()),d3.event.stopPropagation())}).onTap(function(e,t){n.model.marker.clearHighlighted(),n.model.marker.selectMarker(e.KEYS())});var i=a.select("g.vzb-mc-label-x");v.isTouchDevice()?(i.append("rect"),i.append("text").attr("class","vzb-mc-label-x-text").text("Deselect")):(v.setIcon(i,r).select("svg").attr("class","vzb-mc-label-x-icon").attr("width","0px").attr("height","0px"),i.insert("circle","svg"))}).on("mousemove",function(e,t){v.isTouchDevice()||(a.showCloseCross(e,!0),n.model.marker.highlightMarker(e.KEYS()))}).on("mouseout",function(e,t){v.isTouchDevice()||(a.showCloseCross(e,!1),n.model.marker.clearHighlighted())}).on("click",function(e,t){v.isTouchDevice()||(n.model.marker.clearHighlighted(),n.model.marker.selectMarker(e.KEYS()))}).merge(n.selectList)},redraw:function(){var c=this.context,h=c.dataKeys;if(c.selectList&&c.someSelected){var e=c.mountainLabelContainer.append("g").attr("class","vzb-mc-label").append("text").text("0"),d=1.2*e.node().getBBox().height,m=parseFloat(e.style("font-size"))/d;d3.select(e.node().parentNode).remove();var u=c.model.marker.axis_y.getTickFormatter(),i=c.yTitleEl.select("text").node().getBBox().height||0,g=(c.height-3*i)/(c.selectList.data().length+2);g<d&&(d=g);var n="null",r=0,p=c.model.marker.color.getColorlegendMarker().label.getItems(),x=c.model.locale.isRTL();c.selectList.attr("transform",function(e,t){e.aggrLevel!=n&&(r+=d);var a=d*t+2*i+r;return n=e.aggrLevel,"translate("+(x?c.width:0)+","+a+")"}).each(function(e,t){var a=d3.select(this).attr("id",e.KEY()+"-label-"+c._id),i="";i=e.key?"all"===e.key?c.translator("mount/merging/world"):p[e.key]:c._getLabelText(c.values,c.labelNames,e.KEYS());var n=e.valuesPointer.axis_y[v.getKey(e.KEYS(),h.axis_y)],r=i+": "+u(n)+(0===t?" "+c.translator("mount/people"):""),o=a.selectAll(".vzb-mc-label-text").attr("x",(x?-1:1)*d).attr("y",d).text(r).style("font-size",d===g?d*m+"px":null).node().getBBox(),s=a.select(".vzb-mc-label-x");if(v.isTouchDevice()){var l=s.select("text").node().getBBox();s.classed("vzb-revert-color",!0).select(".vzb-mc-label-x-text").classed("vzb-revert-color",!0).attr("x",o.width+1.12*o.height+.5*l.width).attr("y",.55*o.height),s.select("rect").attr("width",l.width+.6*o.height).attr("height",o.height).attr("x",o.width+.9*o.height).attr("y",0).attr("rx",.25*o.height).attr("ry",.25*o.height)}else s.attr("x",o.width+1.1*o.height).attr("y",o.height/3),s.select("circle").attr("r",.4*o.height).attr("cx",(x?-1:1)*(o.width+1.1*o.height)).attr("cy",o.height/3),s.select("svg").attr("x",(x?-1:1)*(o.width+o.height*(1.1-(x?-.4:.4)))).attr("y",o.height*(1/3-.4)).attr("width",.8*o.height).attr("height",.8*o.height);a.select(".vzb-mc-label-legend").attr("r",d/3).attr("cx",(x?-1:1)*d*.4).attr("cy",d/1.5).style("fill",c.cScale(e.valuesPointer.color[v.getKey(e.KEYS(),h.color)])),a.onTap(function(e,t){d3.event.stopPropagation(),c.model.marker.highlightMarker(e.KEYS()),setTimeout(function(){c.model.marker.unhighlightMarker(e.KEYS())},2e3)})})}},showCloseCross:function(e,t){var a=this.context,i=e.KEY();a.selectList.filter(function(e){return e.KEY()==i}).select(".vzb-mc-label-x").classed("vzb-invisible",!t)}});t.default=n},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Vizabi.utils,n=Vizabi.Class.extend({init:function(e){this.context=e},redraw:function(n){var r=this.context;if(n||(n={}),n.level||(n.level=r.model.ui.chart.probeX),r.probeEl.classed("vzb-hidden",!n.level||!r.model.ui.chart.showProbeX),n.level){r.xAxisEl.call(r.xAxis.highlightValue(n.full?n.level:"none"));var o=0,s=0,l=0,e=function(e){o+=e.valuesPointer.axis_y[i.getKey(e.KEYS(),r.dataKeys.axis_y)],r.cached[e.KEY()].forEach(function(e){s+=e.y,r._math.rescale(e.x)<n.level&&(l+=e.y)})};"all"===r.model.marker.stack.which?r.stackedPointers.forEach(e):"none"===r.model.marker.stack.which?r.mountainPointers.forEach(e):r.groupedPointers.forEach(e);var c=d3.format(".3r"),h=r.model.marker.axis_y.getTickFormatter();r.heightOfLabels=r.heightOfLabels||.66*r.height,r.probeTextEl.each(function(e,t){if(8===t){var a=d3.select(this);n.full||r.model.ui.chart.probeX!=r.model.marker.axis_x.tailFatX?a.classed("vzb-hidden",!0):(a.text(r.translator("mount/extremepoverty")).classed("vzb-hidden",!1).attr("x",-r.height).attr("y",r.xScale(n.level)).attr("dy","-1.15em").attr("dx","0.5em").attr("transform","rotate(-90)"),r.heightOfLabels=r.height-a.node().getBBox().width-1.75*a.node().getBBox().height)}}),r.probeTextEl.each(function(e,t){if(8!==t){var a=d3.select(this),i=void 0;0!==t&&4!==t||(i=c(l/s*100)+"%"),1!==t&&5!==t||(i=c(100-l/s*100)+"%"),2!==t&&6!==t||(i=h(o*l/s)),3!==t&&7!==t||(i=h(o*(1-l/s))+" "+r.translator("mount/people")),a.text(i).classed("vzb-hidden",!n.full&&(r.someSelected||0!==t&&4!==t)).attr("x",r.xScale(n.level)+(-1<[0,4,2,6].indexOf(t)?-6:5)).attr("y",r.heightOfLabels).attr("dy",-1<[0,1,4,5].indexOf(t)?0:"1.5em")}}),r.probeLineEl.attr("x1",r.xScale(n.level)).attr("x2",r.xScale(n.level)).attr("y1",r.height+6).attr("y2",0)}}});t.default=n},function(e,t){e.exports='\x3c!-- MountainChart Component --\x3e\n<div class="vzb-mountainchart">\n    <svg class="vzb-mountainchart-svg vzb-export">\n        <g class="vzb-mc-graph">\n            <rect class="vzb-mc-eventarea"></rect>\n            <g class="vzb-mc-year"></g>\n\n            <g class="vzb-mc-mountains-mergestacked"></g>\n            <g class="vzb-mc-mountains-mergegrouped"></g>\n            <g class="vzb-mc-mountains"></g>\n\n            <g class="vzb-mc-decorations">\n                <g class="vzb-mc-x-axis-groups"></g>\n            </g>\n    \n            <g class="vzb-mc-mountains-labels"></g>\n\n\n            <g class="vzb-mc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x"></g>\n\n            <g class="vzb-mc-axis-labels"></g>\n            <g class="vzb-mc-probe">\n                <text class="vzb-shadow vzb-mc-probe-value-ul"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-ur"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dl"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-value-ul"></text>\n                <text class="vzb-mc-probe-value-ur"></text>\n                <text class="vzb-mc-probe-value-dl"></text>\n                <text class="vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-extremepoverty"></text>\n                <line></line>\n            </g>\n\n            <g class="vzb-mc-tooltip vzb-hidden">\n                <rect class="vzb-tooltip-border"></rect>\n                <text class="vzb-tooltip-text"></text>\n            </g>\n        </g>\n        <rect class="vzb-mc-forecastoverlay vzb-hidden" x="0" y="0" width="100%" height="100%" fill="url(#vzb-mc-pattern-lines)" pointer-events=\'none\'></rect>\n    </svg>\n    <svg>\n        <defs>\n            <pattern id="vzb-mc-pattern-lines" x="0" y="0" patternUnits="userSpaceOnUse" width="50" height="50" viewBox="0 0 10 10"> \n                <path d=\'M-1,1 l2,-2M0,10 l10,-10M9,11 l2,-2\' stroke=\'black\' stroke-width=\'3\' opacity=\'0.08\'/>\n            </pattern> \n        </defs>\n    </svg>\n</div>\n'},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Vizabi.Component.get("_dialog").extend("axesmc",{init:function(e,t){this.name="axesmc";var a=this;this.model_binds={"change:ui.chart.xLogStops":function(){a.updateView()},"change:ui.chart.yMaxMethod":function(){a.updateView()}},this.components=[{component:Vizabi.Component.get("minmaxinputs"),placeholder:".vzb-xlimits-container",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(e,t),this.template=i(9)},readyOnce:function(){this._super();var t=this;this.yMaxRadio=this.element.select(".vzb-yaxis-container").selectAll("input").on("change",function(){t.setModel("yMaxMethod",d3.select(this).node().value)}),this.xLogStops=this.element.select(".vzb-xaxis-container").selectAll("input").on("change",function(){t.setModel("xLogStops",d3.select(this).node().value)}),this.probeCheck=this.element.select(".vzb-probe-check").on("change",function(){t.setModel("showProbeX",d3.select(this).property("checked"))}),this.probeFieldEl=this.element.select(".vzb-probe-field").on("change",function(){var e=parseFloat(this.value.replace(",","."));!e||e<=t.model.state.marker.axis_x.tailCutX?this.value=t.model.ui.chart.probeX:(e>t.model.state.marker.axis_x.domainMax&&(e=t.model.state.marker.axis_x.domainMax),this.value=e,t.setModel("probeX",e))}),this.updateView()},updateView:function(){var e=this;this.yMaxRadio.property("checked",function(){return d3.select(this).node().value===e.model.ui.chart.yMaxMethod}),this.xLogStops.property("checked",function(){return-1!==e.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value)}),this.probeCheck.property("checked",this.model.ui.chart.showProbeX),this.probeFieldEl.property("value",this.model.ui.chart.probeX)},setModel:function(e,t){var a=void 0;"yMaxMethod"==e&&(a=t),"xLogStops"==e&&(a=[],this.xLogStops.each(function(){d3.select(this).property("checked")&&a.push(+d3.select(this).node().value)})),"probeX"!=e&&"showProbeX"!=e||(a=t),this.model.ui.chart[e]=a}});t.default=a},function(e,t){e.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axesmc" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axesmc" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title">\n        <%=t ("buttons/axes") %>\n    </div>\n    <div class="vzb-dialog-content">\n        <div class="vzb-yaxis-container">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/mount/maxYvalue") %></p>\n            <form class="vzb-dialog-paragraph">\n                <label><input type="radio" name="ymax" value="immediate"><%=t ("mount/maxYmode/immediate") %></label>\n                <label><input type="radio" name="ymax" value="latest"><%=t ("mount/maxYmode/latest") %></label>\n            </form>\n        </div>\n        <div class="vzb-xaxis-container">\n            <p class="vzb-dialog-sublabel">\n                <%=t ("hints/mount/logXstops") %>\n            </p>\n            <form class="vzb-dialog-paragraph">\n                <input type="checkbox" name="logstops" value="1">1\n                <input type="checkbox" name="logstops" value="2">2\n                <input type="checkbox" name="logstops" value="5">5\n            </form>\n        </div>\n        <p class="vzb-dialog-sublabel">\n            <%=t ("hints/mount/xlimits") %>\n        </p>\n        <div class="vzb-xlimits-container vzb-dialog-paragraph"></div>\n        <div class="vzb-probe-container">\n            <p class="vzb-dialog-sublabel">\n              <input type="checkbox" name="probe" class="vzb-probe-check"> <%=t ("hints/mount/probe") %>\n            </p>\n            <input type="text" class="vzb-probe-field" name="probe">\n        </div>\n    </div>\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <%=t ("buttons/ok") %>\n        </div>\n    </div>\n</div>'}]);
//# sourceMappingURL=mountainchart.min.js.map