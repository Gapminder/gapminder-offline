!function(i){var a={};function s(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=i,s.c=a,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(2);var a,s=i(3),o=(a=s)&&a.__esModule?a:{default:a};var n=Vizabi.Tool.extend("BubbleMap",{init:function(e,t){this.name="bubblemap",this.components=[{component:o.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui","data"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.time","locale","ui"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(e,t)},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},marker:{limit:5e3,space:["entities","time"],hook_lat:{use:"property",autoconfig:{index:0,type:"measure"},_important:!0},hook_lng:{use:"property",autoconfig:{index:1,type:"measure"},_important:!0},label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},size:{autoconfig:{index:2,type:"measure"}},color:{syncModels:["marker_colorlegend"],autoconfig:{}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{map:{path:null,colorGeo:!1,preserveAspectRatio:!0,scale:.95,offset:{top:0,right:0,bottom:0,left:0},projection:"robinson",topology:{path:null,objects:{geo:"land",boundaries:"countries"},geoIdProperty:null}},chart:{superhighlightOnMinimapHover:!0,labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","size","moreoptions","presentation","sidebarcollapse","fullscreen"],dialogs:{popup:["colors","find","size","moreoptions"],sidebar:["colors","find","size"],moreoptions:["opacity","speed","size","colors","presentation","technical","about"]},presentation:!1}},versionInfo:{version:"2.3.1",build:1547630490980}});t.default=n},function(e,t,i){},function(e,t,s){"use strict";function d(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0});var i=Vizabi,b=(i._globals,i.utils),a=i.Component,o=i.helpers,n=o.labels,l=o.topojson,r=o["d3.geoProjection"],h=o["d3.dynamicBackground"],c=i.iconset,m=c.warn,u=c.question,p=a.extend("bubblemap",{init:function(e,t){var i=this;this.name="bubblemap",this.template=s(4),this.bubblesDrawing=null,this.isMobile=b.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"},{name:"data",type:"data"}];var a=this;this.model_binds={"change:time.value":function(e){a._readyOnce&&a.model.marker.getFrame(a.model.time.value,a.frameChanged.bind(a))},"change:marker.highlight":function(e){a._readyOnce&&(a.highlightMarkers(),a.updateOpacity())},"change:marker":function(e,t){a._readyOnce&&-1<t.indexOf("scaleType")&&a.ready()},"change:ui.chart.showForecastOverlay":function(e){a._readyOnce&&a._updateForecastOverlay()},"change:marker.size.extent":function(e,t){a._readyOnce&&a.entityBubbles&&(a.updateMarkerSizeLimits(),a.redrawDataPoints(null,!1))},"change:marker.color.palette":function(e,t){a._readyOnce&&a.redrawDataPoints(null,!1)},"change:marker.select":function(e){a._readyOnce&&(a.selectMarkers(),a.redrawDataPoints(null,!1),a.updateOpacity(),a.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(e){a.updateOpacity()},"change:marker.opacityRegular":function(e){a.updateOpacity()},"change:marker.superHighlight":function(){return i._readyOnce&&i._blinkSuperHighlighted()}},this._super(e,t),this.sScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),a.COLOR_WHITEISH="#fdfdfd",r(),this._labels=new n(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.mapSvg=this.element.select(".vzb-bmc-map-background"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.forecastOverlay=this.element.select(".vzb-bmc-forecastoverlay"),this.entityBubbles=null,this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new h(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var e=this;this.on("resize",function(){e.updateSize()||(e.updateMarkerSizeLimits(),e._labels.updateSize(),e.redrawDataPoints())}),this.initMap(),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=b.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce()},ready:function(){var i=this;this.KEYS=b.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,t){t.toString()==i.model.time.value.toString()?e&&(i.values=e,i.updateEntities(),i.updateTime(),i._labels.ready(),i.redrawDataPoints(),i.highlightMarkers(),i.selectMarkers(),i.updateDoubtOpacity(),i.updateOpacity()):b.defer(function(){i.ready()})})},frameChanged:function(e,t){t.toString()==this.model.time.value.toString()&&e&&(this.values=e,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1))},updateUIStrings:function(){var s=this;this.translator=this.model.locale.getTFunction();var e=s.model.marker.size.getConceptprops(),t=s.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:t.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){s.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(s.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){s.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(s.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),b.setIcon(this.dataWarningEl,m).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){s.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){s.updateDoubtOpacity(1)}).on("mouseout",function(){s.updateDoubtOpacity()}),this.yInfoEl.html(u).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),this.yInfoEl.on("click",function(){s.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),t=b.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),i=s.root.element.getBoundingClientRect(),a=s.element.node().getBoundingClientRect();s.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(t.x+a.left-i.left,t.y)}),this.yInfoEl.on("mouseout",function(){s.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(u).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(t.description||t.sourceLink))),this.cInfoEl.on("click",function(){s.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),t=b.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),i=s.root.element.getBoundingClientRect(),a=s.element.node().getBoundingClientRect();s.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(t.x+a.left-i.left,t.y)}),this.cInfoEl.on("mouseout",function(){s.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var e=this,t=void 0;if(e.isMobile&&e.model.marker.select&&1===e.model.marker.select.length&&(t=e.model.marker.select[0]),e.hovered||t){var i=e.model.marker.size.getConceptprops(),a=e.model.marker.color.getConceptprops(),s=e.hovered||t,o=e.model.marker.size.getTickFormatter(),n=e.model.marker.color.getTickFormatter(),l=i.unit||"",r=a.unit||"",h=e.values.size[b.getKey(s,this.dataKeys.size)],d=e.values.color[b.getKey(s,this.dataKeys.color)];e.model.marker.color.isDiscrete()&&d&&(d=this.model.marker.color.getColorlegendMarker().label.getItems()[d]||""),e.yTitleEl.select("text").text(e.translator("buttons/size")+": "+o(h)+" "+l),e.cTitleEl.select("text").text(e.translator("buttons/color")+": "+(d||0===d?n(d)+" "+r:e.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(e){null==e&&(e=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(e=1),this.dataWarningEl.style("opacity",e)},updateOpacity:function(){var t=this,i=this.model.marker.opacityRegular,a=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(e){return t.someHighlighted&&t.model.marker.isHighlighted(e)?1:t.someSelected?t.model.marker.isSelected(e)?1:a:t.someHighlighted?.3:i}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var s=t.model.marker.opacitySelectDim<.01;s!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(e){return t.someSelected&&s&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateEntities:function(){var a=this,s=this.KEYS,o=this.KEY,n=this.TIMEDIM,l=this.model.time.end;this.model.marker.setVisible(function(i){return i=i||"",a.model.marker.getKeys().map(function(e){var t=Object.assign({},e);return t[n]=l,t.sortValue=a.values.size[b.getKey(e,a.dataKeys.size)]||0,t[o]=i+b.getKey(e,s),t}).sort(function(e,t){return t.sortValue-e.sortValue})}.call(this)),this.model.time.splash||this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(this.model.marker.getVisible(),function(e){return e[o]}).order(),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,t){b.isTouchDevice()||a._interact()._mouseover(e,t)}).on("mouseout",function(e,t){b.isTouchDevice()||a._interact()._mouseout(e,t)}).on("click",function(e,t){b.isTouchDevice()||(a._interact()._click(e,t),a.highlightMarkers())}).onTap(function(e,t){a._interact()._click(e,t),d3.event.stopPropagation()}).onLongTap(function(e,t){}).merge(this.entityBubbles)},unselectBubblesWithNoData:function(i){var a=this;i||(i=this.values),i&&i.size&&this.model.marker.select.forEach(function(e){var t=i.size[b.getKey(e,a.dataKeys.size)];t||0===t||a.model.marker.selectMarker(e)})},redrawDataPoints:function(c,m){var u=this;if(c||(c=this.duration),m||(m=!0),!this.entityBubbles)return b.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!");var p=this.dataKeys,g=this.values;this.entityBubbles.each(function(e,t){var i=d3.select(this),a=d3.select("#"+e[u.KEY]),s=g.hook_lng[b.getKey(e,p.hook_lng)],o=g.hook_lat[b.getKey(e,p.hook_lat)],n=g.size[b.getKey(e,p.size)],l=g.color[b.getKey(e,p.color)],r=g.label[b.getKey(e,p.label)];e.hidden_1=e.hidden,e.hidden=!n&&0!==n||null==s||null==o;var h=e.hidden!==e.hidden_1;if(e.hidden)h&&(c?i.transition().duration(c).ease(d3.easeLinear).style("opacity",0).on("end",function(){return i.classed("vzb-hidden",e.hidden).style("opacity",u.model.marker.opacityRegular)}):i.classed("vzb-hidden",e.hidden)),u._updateLabel(e,t,0,0,n,l,r,c);else{if(e.r=b.areaToRadius(u.sScale(n||0)),e.label=r,i.attr("fill",null!=l?u.cScale(l):u.COLOR_WHITEISH),u.model.ui.map.colorGeo&&a.style("fill",null!=l?u.cScale(l):"#999"),m&&(e.cLoc=u.skew(u.projection([s||0,o||0])),i.attr("cx",e.cLoc[0]).attr("cy",e.cLoc[1])),c)if(h){var d=i.style("opacity");i.classed("vzb-hidden",e.hidden),i.style("opacity",0).attr("r",e.r).transition().duration(c).ease(d3.easeExp).style("opacity",d)}else i.transition().duration(c).ease(d3.easeLinear).attr("r",e.r);else i.interrupt().attr("r",e.r).transition(),h&&i.classed("vzb-hidden",e.hidden);u._updateLabel(e,t,e.cLoc[0],e.cLoc[1],n,l,e.label,c)}})},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&0<this.time-this.time_1?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this._updateForecastOverlay(),this.updateTitleNumbers()},_updateForecastOverlay:function(){this.forecastOverlay.classed("vzb-hidden",this.model.time.value<=this.model.time.endBeforeForecast||!this.model.time.endBeforeForecast||!this.model.ui.chart.showForecastOverlay)},fitSizeOfTitles:function(){var e=this.yTitleEl.select("text");e.style("font-size",null);var t=this.cTitleEl.select("text");t.style("font-size",null);var i=e.node().getBBox(),a=this.cTitleEl.classed("vzb-hidden")?i:t.node().getBBox(),s=Math.max(parseInt(e.style("font-size")),parseInt(t.style("font-size")))*this.width/Math.max(i.width,a.width);Math.max(i.width,a.width)>this.width?(e.style("font-size",s+"px"),t.style("font-size",s+"px")):(e.style("font-size",null),t.style("font-size",null))},initMap:function(){var t=this;this.topology||b.warn("bubble map afterPreload: missing country shapes "+this.topology),this.projection=d3["geo"+b.capitalize(this.model.ui.map.projection)](),this.mapPath=d3.geoPath().projection(this.projection),this.mapGraph=this.element.select(".vzb-bmc-map-graph"),this.mapGraph.html(""),this.mapFeature=l.feature(this.topology,this.topology.objects[this.model.ui.map.topology.objects.geo]);var e=l.mesh(this.topology,this.topology.objects[this.model.ui.map.topology.objects.boundaries],function(e,t){return e!==t});this.projection.scale(1).translate([0,0]),this.mapBounds=this.mapPath.bounds(this.mapFeature),this.mapFeature.features?this.mapGraph.selectAll(".land").data(this.mapFeature.features).enter().insert("path").attr("d",this.mapPath).attr("id",function(e){return e.properties[t.model.ui.map.topology.geoIdProperty].toLowerCase()}).attr("class","land"):this.mapGraph.insert("path").datum(this.mapFeature).attr("class","land"),this.mapGraph.insert("path").datum(e).attr("class","boundary")},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadiusPx:.5,maxRadiusEm:.05},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadiusPx:1,maxRadiusEm:.05},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadiusPx:1,maxRadiusEm:.05}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*b.hypotenuse(e.width,e.height));var t=this.activeProfile.margin;this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,b.warn("Bubble map chart updateSize(): vizabi container is too little or has display:none")),this.repositionElements(),this.rescaleMap()},repositionElements:function(){var e=this.activeProfile.margin,t=this.activeProfile.infoElHeight,i=this.model.locale.isRTL();this.graph.attr("transform","translate("+e.left+","+e.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height),this.yTitleEl.style("font-size",t).attr("transform","translate("+(i?this.width:0)+","+e.top+")");var a=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(i?this.width:0)+","+(e.top+a.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var s=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*s.height).attr("height",.75*s.height).attr("x",-s.width-1.2*s.height).attr("y",.65*-s.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*s.height)+")").select("text"),this.yInfoEl.select("svg").node()){var o=this.yTitleEl.node().getBBox(),n=b.transform(this.yTitleEl.node()),l=i?o.x+n.translateX-1.4*t:o.x+n.translateX+o.width+.4*t;this.yInfoEl.select("svg").attr("width",t).attr("height",t),this.yInfoEl.attr("transform","translate("+l+","+(n.translateY-.8*t)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var r=this.cTitleEl.node().getBBox(),h=b.transform(this.cTitleEl.node()),d=i?r.x+h.translateX-1.4*t:r.x+h.translateX+r.width+.4*t;this.cInfoEl.select("svg").attr("width",t).attr("height",t),this.cInfoEl.attr("transform","translate("+d+","+(h.translateY-.8*t)+")")}},rescaleMap:function(){var e=this.model.ui.map.offset,t=this.activeProfile.margin,i=this.model.ui.map.scale/Math.max((this.mapBounds[1][0]-this.mapBounds[0][0])/this.width,(this.mapBounds[1][1]-this.mapBounds[0][1])/this.height),a=i*(this.mapBounds[1][0]-this.mapBounds[0][0]),s=i*(this.mapBounds[1][1]-this.mapBounds[0][1]),o=s*(1+e.top+e.bottom),n=a*(1+e.left+e.right),l=s*e.top,r=a*e.left,h=[(a-i*(this.mapBounds[1][0]+this.mapBounds[0][0]))/2,(s-i*(this.mapBounds[1][1]+this.mapBounds[0][1]))/2];this.projection.scale(i).translate(h),this.mapGraph.selectAll("path").attr("d",this.mapPath);var d=void 0,c=void 0;if(this.model.ui.map.preserveAspectRatio)c=d=1;else{var m=o,u=n;o=this.height*this.model.ui.map.scale,n=this.width*this.model.ui.map.scale,this.mapSvg.attr("preserveAspectRatio","none").attr("viewBox",[0,0,u,m].join(" ")),d=n/(a||1)/(1+e.left+e.right),c=o/(s||1)/(1+e.top+e.bottom)}this.mapGraph.attr("transform","translate("+r+","+l+")"),this.mapSvg.style("transform","translate3d("+(t.left+(this.width-n)/2)+"px,"+(t.top+(this.height-o)/2)+"px,0)").attr("width",n).attr("height",o);var p,g,b=this;this.skew=(p=b.width,g=b.height,function(e){return[e[0]*d+(p-n)/2+r*d,e[1]*c+(g-o)/2+l*c]})},updateMarkerSizeLimits:function(){var e=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return b.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var t=this.activeProfile.minRadiusPx,i=this.activeProfile.maxRadiusPx,a=b.radiusToArea(Math.max(i*e[0],t)),s=b.radiusToArea(Math.max(i*e[1],t)),o=a===s?[a,s]:d3.range(a,s,(s-a)/this.sScale.domain().length).concat(s);this.sScale.range(o)},_interact:function(){var i=this;return{_mouseover:function(e,t){i.model.time.dragging||(i.model.marker.highlightMarker(e),i.hovered=e,i.updateTitleNumbers(),i.fitSizeOfTitles(),i.model.marker.isSelected(e)?i._setTooltip():i._setTooltip(e))},_mouseout:function(e,t){i.model.time.dragging||(i._setTooltip(),i.hovered=null,i.updateTitleNumbers(),i.fitSizeOfTitles(),i.model.marker.clearHighlighted())},_click:function(e,t){i.model.marker.selectMarker(e)}}},_blinkSuperHighlighted:function(){var t=this;this.entityBubbles.classed("vzb-super-highlighted",function(e){return t.model.marker.isSuperHighlighted(e)})},highlightMarkers:function(){this.someHighlighted=0<this.model.marker.highlight.length,b.isTouchDevice()&&(this.someHighlighted?this.hovered=this.model.marker.highlight[0]:this.hovered=null,this.updateTitleNumbers(),this.fitSizeOfTitles())},_updateLabel:function(e,t,i,a,s,o,n,l){var r=this;if(e[this.KEY]!=r.druging&&(null==l&&(l=r.duration),r.model.marker.isSelected(e))){var h=e.hidden!==e.hidden_1,d={};d.labelX0=i/this.width,d.labelY0=a/this.height,d.scaledS0=s?b.areaToRadius(r.sScale(s)):null,d.scaledC0=null!=o?r.cScale(o):r.COLOR_WHITEISH;var c=this._getLabelText(this.values,this.labelNames,e);this._labels.updateLabel(e,t,d,i/this.width,a/this.height,s,o,c,null,l,h)}},selectMarkers:function(){var e=this;this.KEY;this.someSelected=0<this.model.marker.select.length,b.isTouchDevice()?(e._labels.showCloseCross(null,!1),e.someHighlighted?e.model.marker.clearHighlighted():(e.updateTitleNumbers(),e.fitSizeOfTitles())):e.hovered&&!e.model.marker.isSelected(e.hovered)||e._setTooltip(),this.nonSelectedOpacityZero=!1},_getLabelText:function(t,i,a){return this.KEYS.map(function(e){return t[i[e]]?t[i[e]][a[e]]:a[e]}).join(", ")},_setTooltip:function(e){if(e){this.KEY;var t=this.values,i={},a={},s=d3.mouse(this.graph.node()).map(function(e){return parseInt(e)}),o=e.cLoc[0]||s[0],n=e.cLoc[1]||s[1],l=e.r||0;i.valueS=t.size[b.getKey(e,this.dataKeys.size)],i.labelText=this._getLabelText(t,this.labelNames,e),a.labelX0=i.valueX=o/this.width,a.labelY0=i.valueY=n/this.height,a.scaledS0=l,a.scaledC0=null,this._labels.setTooltip(e,i.labelText,a,i)}else this._labels.setTooltip()},preload:function(){var s=this,o=this,n=function(e,t){o.model.data.getAsset(e,function(e){o.topology=e,t()})},l=b.getProp(this,["model","ui","map","topology","path"]),r=b.getProp(this,["model","ui","map","topology","which"]),h=b.getProp(this,["model","ui","map","topology","key"]);return new Promise(function(t,e){if(l)n(l,t);else if(r){var i=s.model.marker._getFirstDimension({exceptType:"time"}),a={language:s.model.locale.id,from:"entities",select:{key:[i],value:[r]},where:{$and:[d({},i,"$"+i)]},join:d({},"$"+i,{key:i,where:d({},i,{$in:[h||"world"]})})};s.model.data.load(a,d({},r,function(e){return e})).then(function(e){n(o.model.data.getData(e)[0][r],t)},function(e){return b.warn("Problem with Preload query: ",e,JSON.stringify(a))})}else n("assets/world-50m.json",t)})}});t.default=p},function(e,t){e.exports='\x3c!-- Bubble Map Chart Component --\x3e\n<div class="vzb-bubblemap">\n    <svg class="vzb-bmc-map-background vzb-export">\n        <g class="vzb-bmc-map-graph"></g>\n    </svg>\n    <svg class="vzb-bubblemap-svg vzb-export">\n        <g class="vzb-bmc-graph">\n            <g class="vzb-bmc-year"></g>\n\n            <g class="vzb-bmc-lines"></g>\n            <g class="vzb-bmc-bubbles"></g>\n            <g class="vzb-bmc-bubble-labels"></g>\n\n\n            <g class="vzb-bmc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-c-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-y-info vzb-noexport">\n            </g>\n\n            <g class="vzb-bmc-axis-c-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n            <g class="vzb-bmc-labels"></g>\n        </g>\n        <rect class="vzb-bmc-forecastoverlay vzb-hidden" x="0" y="0" width="100%" height="100%" fill="url(#vzb-bmc-pattern-lines)" pointer-events=\'none\'></rect>\n    </svg>\n    <svg>\n        <defs>\n            <pattern id="vzb-bmc-pattern-lines" x="0" y="0" patternUnits="userSpaceOnUse" width="50" height="50" viewBox="0 0 10 10"> \n                <path d=\'M-1,1 l2,-2M0,10 l10,-10M9,11 l2,-2\' stroke=\'black\' stroke-width=\'3\' opacity=\'0.08\'/>\n            </pattern> \n        </defs>\n    </svg>\n</div>\n'}]);
//# sourceMappingURL=bubblemap.min.js.map